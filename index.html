<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pour Samuella ðŸŒ¹</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Dancing+Script:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: linear-gradient(180deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            font-family: 'Cormorant Garamond', serif;
            touch-action: none;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
        }

        .header {
            text-align: center;
            pointer-events: auto;
            animation: fadeInDown 2s ease-out;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin: 0 auto;
            max-width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2.5rem, 8vw, 4rem);
            background: linear-gradient(45deg, #ff6b9d, #feca57, #ff9ff3, #ff6b9d);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 5s ease infinite;
            text-shadow: none;
            margin-bottom: 10px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .subtitle {
            font-size: clamp(1rem, 3vw, 1.3rem);
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .instruction {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px 25px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
            animation: pulse 2s infinite;
            white-space: nowrap;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.8; }
            50% { transform: translateX(-50%) scale(1.05); opacity: 1; }
        }

        .poem-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            padding: 20px;
        }

        .poem-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .poem-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 25px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 
                        inset 0 0 30px rgba(255, 107, 157, 0.1);
            transform: scale(0.9);
            transition: transform 0.5s ease;
        }

        .poem-modal.active .poem-card {
            transform: scale(1);
        }

        .poem-number {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff6b9d, #feca57);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
        }

        .poem-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2rem, 6vw, 2.5rem);
            color: #ff6b9d;
            margin-bottom: 20px;
            margin-top: 10px;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .poem-text {
            font-size: clamp(1.1rem, 3.5vw, 1.4rem);
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.95);
            white-space: pre-line;
            font-style: italic;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255, 107, 157, 0.3);
            transform: rotate(90deg);
        }

        .progress-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 20;
            pointer-events: auto;
        }

        .progress-text {
            color: white;
            font-family: 'Dancing Script', cursive;
            font-size: 1.3rem;
            margin-bottom: 8px;
            text-align: center;
        }

        .progress-dots {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .dot.collected {
            background: #ff6b9d;
            box-shadow: 0 0 10px #ff6b9d;
            transform: scale(1.2);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #0f0c29 0%, #302b63 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s ease;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-rose {
            font-size: 5rem;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(255, 107, 157, 0.6));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .loading-text {
            color: white;
            margin-top: 30px;
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            animation: fadeInOut 2s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            z-index: 200;
            pointer-events: none;
            opacity: 0;
            animation: celebrate 2s ease-out forwards;
        }

        @keyframes celebrate {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.5) rotate(180deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(2) rotate(360deg); }
        }

        @media (max-width: 480px) {
            .poem-card {
                padding: 30px 20px;
            }

            .header {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-rose">ðŸŒ¹</div>
        <div class="loading-text">PrÃ©paration du jardin d'amour...</div>
    </div>

    <div id="canvas-container"></div>

    <div id="ui-layer">
        <div class="header">
            <h1>Pour Samuella</h1>
            <div class="subtitle">Un jardin de roses, un cÅ“ur de poÃ¨mes</div>
        </div>

        <div class="instruction">
            ðŸŒ¹ Touche une rose pour dÃ©couvrir un poÃ¨me
        </div>

        <div class="progress-bar">
            <div class="progress-text">Roses cueillies</div>
            <div class="progress-dots" id="progressDots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <div class="poem-modal" id="poemModal">
        <div class="poem-card">
            <div class="poem-number" id="poemNumber">1</div>
            <button class="close-btn" onclick="closePoem()">Ã—</button>
            <div class="poem-title" id="poemTitle"></div>
            <div class="poem-text" id="poemText"></div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // PoÃ¨mes pour Samuella
        const poems = [
            {
                title: "Ã‰ternitÃ©",
                text: `Dans tes yeux, je vois l'infini,
Un univers oÃ¹ je veux vieillir.
Chaque battement de mon cÅ“ur
Ã‰pelle ton nom en secret.

Tu es le poÃ¨me
Que la vie a Ã©crit pour moi,
Le plus beau des hasards,
Mon Ã©ternitÃ©.`
            },
            {
                title: "LumiÃ¨re",
                text: `Tu es la lumiÃ¨re qui perce
Mes nuits les plus sombres.
Avec toi, chaque matin
Est une renaissance.

Ton rire Ã©claire mon Ã¢me,
Ta prÃ©sence me guÃ©rit.
Tu es mon soleil intÃ©rieur,
Mon phare, ma vÃ©ritÃ©.`
            },
            {
                title: "Douceur",
                text: `Il n'y a pas de mot assez doux
Pour dire ce que je ressens.
Alors je te donne mon silence,
Mes mains, mes temps.

Dans le creux de ton Ã©paule,
J'ai trouvÃ© ma maison.
Ton cÅ“ur bat au rythme du mien,
Notre symphonie parfaite.`
            },
            {
                title: "Aventure",
                text: `Avec toi, chaque instant
Est une nouvelle aventure.
Le monde s'efface
Quand je te regarde.

Je veux dÃ©couvrir
Chaque recoin de ton Ã¢me,
Chaque rÃªve, chaque peur,
Et les chÃ©rir tous.`
            },
            {
                title: "Promesse",
                text: `Je te promets les saisons,
Les tempÃªtes et les calmes.
Je te promets mes matins
Et toutes mes nuits.

Je te promets de t'aimer
Non pas comme on aime un jour,
Mais comme on aime toujours,
Sans fin, sans peur, sans raison.

Joyeuse Saint-Valentin, mon amour.`
            }
        ];

        let scene, camera, renderer, controls;
        let roses = [];
        let particles;
        let raycaster, mouse;
        let collectedRoses = new Set();
        let isMobile = window.matchMedia("(pointer: coarse)").matches;

        function init() {
            // ScÃ¨ne avec fond dÃ©gradÃ© foncÃ©
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x0f0c29, 0.02);

            // CamÃ©ra
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 12);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // ContrÃ´les
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2 - 0.1;
            controls.minDistance = 5;
            controls.maxDistance = 20;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.3;

            // LumiÃ¨res
            const ambientLight = new THREE.AmbientLight(0x404080, 0.5);
            scene.add(ambientLight);

            const moonLight = new THREE.DirectionalLight(0x9999ff, 0.5);
            moonLight.position.set(10, 20, 10);
            moonLight.castShadow = true;
            scene.add(moonLight);

            // LumiÃ¨res colorÃ©es pour l'ambiance
            const pinkLight = new THREE.PointLight(0xff6b9d, 1, 20);
            pinkLight.position.set(-5, 5, -5);
            scene.add(pinkLight);

            const goldLight = new THREE.PointLight(0xfeca57, 0.8, 20);
            goldLight.position.set(5, 5, 5);
            scene.add(goldLight);

            // Sol
            const groundGeometry = new THREE.CircleGeometry(15, 64);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1a1a2e,
                roughness: 0.8,
                metalness: 0.2
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Raycaster
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // CrÃ©er les Ã©lÃ©ments
            createRoses();
            createFireflies();

            // Events
            window.addEventListener('resize', onWindowResize);

            if (isMobile) {
                renderer.domElement.addEventListener('touchstart', onTouchStart, { passive: false });
            } else {
                renderer.domElement.addEventListener('click', onClick);
                renderer.domElement.addEventListener('mousemove', onMouseMove);
            }

            // Cacher loading
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 2000);

            animate();
        }

        function createRoses() {
            const positions = [
                { x: -4, z: -2 },
                { x: 4, z: -2 },
                { x: 0, z: -5 },
                { x: -3, z: 2 },
                { x: 3, z: 2 }
            ];

            positions.forEach((pos, index) => {
                const roseGroup = new THREE.Group();

                // Tige
                const stemGeometry = new THREE.CylinderGeometry(0.05, 0.08, 2, 8);
                const stemMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x2d5a27,
                    roughness: 0.7 
                });
                const stem = new THREE.Mesh(stemGeometry, stemMaterial);
                stem.position.y = 1;
                stem.castShadow = true;
                roseGroup.add(stem);

                // Feuilles
                for (let i = 0; i < 3; i++) {
                    const leafGeometry = new THREE.SphereGeometry(0.3, 8, 8);
                    leafGeometry.scale(1, 0.1, 2);
                    const leaf = new THREE.Mesh(leafGeometry, stemMaterial);
                    leaf.position.y = 0.5 + i * 0.4;
                    leaf.position.x = Math.sin(i * 2) * 0.3;
                    leaf.rotation.z = Math.sin(i * 2) * 0.5;
                    leaf.rotation.y = i * 2;
                    roseGroup.add(leaf);
                }

                // PÃ©tales de rose (sphÃ¨res dÃ©formÃ©es)
                const petalColors = [0xff0040, 0xff1744, 0xf50057, 0xd50000, 0xc51162];
                const petalMaterial = new THREE.MeshStandardMaterial({
                    color: petalColors[index],
                    roughness: 0.3,
                    metalness: 0.1,
                    emissive: petalColors[index],
                    emissiveIntensity: 0.2
                });

                // Centre de la rose
                const centerGeometry = new THREE.SphereGeometry(0.4, 16, 16);
                const center = new THREE.Mesh(centerGeometry, petalMaterial);
                center.position.y = 2.2;
                roseGroup.add(center);

                // PÃ©tales extÃ©rieurs
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const petalGeometry = new THREE.SphereGeometry(0.35, 16, 16);
                    petalGeometry.scale(1, 0.3, 1.5);
                    const petal = new THREE.Mesh(petalGeometry, petalMaterial);
                    petal.position.y = 2.2;
                    petal.position.x = Math.cos(angle) * 0.5;
                    petal.position.z = Math.sin(angle) * 0.5;
                    petal.rotation.y = -angle;
                    petal.rotation.x = 0.3;
                    roseGroup.add(petal);
                }

                // Positionnement
                roseGroup.position.set(pos.x, 0, pos.z);

                // Animation flottante
                roseGroup.userData = {
                    poemIndex: index,
                    originalY: 0,
                    phase: Math.random() * Math.PI * 2,
                    speed: 0.5 + Math.random() * 0.5,
                    collected: false
                };

                scene.add(roseGroup);
                roses.push(roseGroup);

                // LumiÃ¨re ponctuelle pour chaque rose
                const roseLight = new THREE.PointLight(petalColors[index], 0.5, 5);
                roseLight.position.set(pos.x, 3, pos.z);
                scene.add(roseLight);
            });
        }

        function createFireflies() {
            const particleCount = isMobile ? 30 : 80;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 20;
                positions[i * 3 + 1] = Math.random() * 8;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 20;

                const color = new THREE.Color();
                color.setHSL(Math.random() * 0.1 + 0.9, 1, 0.8);
                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.15,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onTouchStart(event) {
            event.preventDefault();
            const touch = event.touches[0];
            mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;
            checkIntersection();
        }

        function onClick(event) {
            checkIntersection();
        }

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);

            // VÃ©rifier intersection avec les roses
            for (let rose of roses) {
                if (rose.userData.collected) continue;

                const intersects = raycaster.intersectObject(rose, true);
                if (intersects.length > 0) {
                    collectRose(rose);
                    return;
                }
            }
        }

        function collectRose(rose) {
            if (rose.userData.collected) return;

            rose.userData.collected = true;
            const index = rose.userData.poemIndex;

            // Animation de collecte
            const startY = rose.position.y;
            const animateCollect = () => {
                rose.position.y += 0.1;
                rose.rotation.y += 0.1;
                rose.scale.multiplyScalar(0.95);

                if (rose.scale.x > 0.1) {
                    requestAnimationFrame(animateCollect);
                } else {
                    rose.visible = false;
                }
            };
            animateCollect();

            // Afficher le poÃ¨me
            showPoem(index);

            // Mettre Ã  jour la progression
            if (!collectedRoses.has(index)) {
                collectedRoses.add(index);
                updateProgress();

                // CÃ©lÃ©bration si toutes collectÃ©es
                if (collectedRoses.size === poems.length) {
                    setTimeout(celebrate, 1000);
                }
            }
        }

        function showPoem(index) {
            const poem = poems[index];
            document.getElementById('poemNumber').textContent = index + 1;
            document.getElementById('poemTitle').textContent = poem.title;
            document.getElementById('poemText').textContent = poem.text;
            document.getElementById('poemModal').classList.add('active');

            // Pause la rotation auto quand poÃ¨me ouvert
            controls.autoRotate = false;
        }

        window.closePoem = function() {
            document.getElementById('poemModal').classList.remove('active');
            controls.autoRotate = true;
        };

        function updateProgress() {
            const dots = document.querySelectorAll('.dot');
            dots.forEach((dot, index) => {
                if (collectedRoses.has(index)) {
                    dot.classList.add('collected');
                }
            });
        }

        function celebrate() {
            // CrÃ©er effet de cÃ©lÃ©bration
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = 'ðŸŒ¹ðŸ’•ðŸŒ¹';
            document.body.appendChild(celebration);

            setTimeout(() => {
                celebration.remove();
            }, 2000);

            // Message final
            setTimeout(() => {
                alert("Tu as dÃ©couvert tous mes poÃ¨mes pour toi, Samuella. Je t'aime. ðŸ’•");
            }, 1000);
        }

        function animate() {
            requestAnimationFrame(animate);

            const time = Date.now() * 0.001;

            // Animer les roses non collectÃ©es
            roses.forEach(rose => {
                if (!rose.userData.collected) {
                    rose.position.y = rose.userData.originalY + 
                        Math.sin(time * rose.userData.speed + rose.userData.phase) * 0.2;
                    rose.rotation.y = Math.sin(time * 0.5 + rose.userData.phase) * 0.1;
                }
            });

            // Animer les lucioles
            if (particles) {
                particles.rotation.y = time * 0.05;
                const positions = particles.geometry.attributes.position.array;
                for (let i = 0; i < positions.length; i += 3) {
                    positions[i + 1] += Math.sin(time + positions[i]) * 0.01;
                }
                particles.geometry.attributes.position.needsUpdate = true;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>